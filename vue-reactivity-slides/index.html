<!DOCTYPE html>
<html lang="ru">
<head>
    <title>Реактивность Vue.js</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="node_modules/@shower/material/styles/styles.css">
    <style>
        .shower {
            --slide-ratio: calc(16 / 9);
        }
        .none {
            display: none;
            opacity: 0;
        }
        .crossout {
            text-decoration: line-through;
        }
    </style>
    <script src="https://unpkg.com/vue"></script>
</head>
<body class="shower list">

    <header class="caption">
        <h1>Реактивный Vue.js</h1>
        <p>Заглядываем под обшивку ракеты</p>
    </header>

    <section class="slide" id="main">
        <h2 class="shout">
            Реактивный<br> Vue.js
            <p>Заглядываем под обшивку ракеты</p>
        </h2>
        <style>
            #main p {
                margin: 30px 0 0;
                font-size: 50px;
            }
        </style>
    </section>

    <section class="slide">
        <h2>
            Докладчик
        </h2>
        <ul>
            Кучук Андрей
            <li>Фронт-энд разработчик Epicmax</li>
            <li>Докладчик Rolling Scopes</li>
            <li>Ментор Rolling Scopes School</li>
        </ul>

        Github: <a href="https://github.com/Kreezag" alt="">https://github.com/Kreezag</a>
        <br>
        Twitter: <a href="https://twitter.com/Kreez_AG" alt="">https://twitter.com/Kreez_AG</a>
    </section>

    <section class="slide" id="workshop">
        <h2>
             Идея доклада
        </h2>
        <br>
        <br>
        <br>
        <br>
        <p>
            Мастеркласс Эвана Ю
            <br>
            Advanced Vue.js Features from the Ground Up
        </p>
        <div>
            <img class="cover width" src="https://images.ctfassets.net/tfws0ki30xlo/3BaAu4sUiQwaiUcuueuEqy/4b8c89d22c42093e96159a0d6b1433f8/image5.jpg?fit=scale&q=100&w=1000" alt="vue workshop">
        </div>
        <style>
            #workshop h2 {
                color: #ffffff;
            }
            #workshop p {
                color: #ffffff;
            }
        </style>
    </section>

    <section class="slide">
        <h2>
            Содержание
        </h2>
        <ol>
            <li>Коротко о фреймворке</li>
            <li>Идеи реактивности</li>
            <li>Реализация реактивности</li>
            <li>Live coding</li>
            <li>Заключение</li>
        </ol>
    </section>

    <section class="slide">
        <h2 class="shout">
            Что такое Vue.js
        </h2>
    </section>

    <section class="slide" id="vue-logo">
        <h2>
            Что такое Vue.js
        </h2>
        <blockquote>
            <p>
                Vue (произносится /vjuː/, примерно как view) — это прогрессивный фреймворк для создания пользовательских интерфейсов.
            </p>
        </blockquote>
        <style>
            #vue-logo {
                background: #fff url(https://vuejs.org/images/logo.png) 90% 90% no-repeat;
                background-size: 15%;
            }
        </style>
    </section>

    <section class="slide">
        <h2>
            Преимущества
        </h2>
        <ul>
            <li> Легковесный (~20КБ gzip в ядре и ~30КБ в роутингом и хранилищем)</li>
            <li>Относительно простой в изучении</li>
            <li>Возможность частичного внедрения</li>
            <li>Поддержка крупными компаниями (Alibaba)</li>
            <li>Реактивность</li>
        </ul>
    </section>

    <section class="slide">
        <h2>
            Недостатки
        </h2>
        <ul>
            <li>Излишняя гибкость</li>
            <li>Неясные архитектурные шаблоны</li>
            <li>Замкнут на себе</li>
            <li>Меньше сторонних библиотек</li>
        </ul>
    </section>

    <section class="slide">
        <h2 class="shout">
            Идея <br> реактивности
        </h2>
    </section>


    <section class="slide">
        <h2>
            Реактивность в js
        </h2>
        <pre>
            <code>let a = { state: 1 };</code>
            <code>let b = a;<span class="comment">// b === { state: 1 }</span></code>
            <code> </code>
            <code>a.state = 2;<span class="comment">// b === { state: 2 }</span></code>
            <code></code>
            <code>b.state + 1<span class="comment">// a === { state: 3 }, b === { state: 3 }, </span></code>
        </pre>
    </section>

    <section class="slide">
        <h2>
            Реактивность в js
        </h2>
        <p>
            Потому что это один и тот же обьект в памяти
        </p>
        <pre>
            <code> a === b <span class="comment">// true </span></code>
        </pre>
    </section>

    <section class="slide">
        <h2>
            Идея реактивности Vue.js
        </h2>
         <blockquote>
             <p>
                 Одна из наиболее примечательных возможностей Vue — это ненавязчивая реактивность.
                 Модели представляют собой простые JavaScript-объекты.
                 По мере их изменения обновляется и представление данных,
                 благодаря чему управление состоянием приложения становится простым и очевидным.
             </p>
         </blockquote>
    </section>

    <section class="slide">
        <h2>
            Счетчик на vue
        </h2>
        <div>
            <div id="vue1"></div>
        </div>
    </section>

    <script>
      new Vue({
        data: {
          count: 1
        },
        methods: {
            increment () {
              this.count += 1
            },
            decrement () {
              this.count -= 1
            }
        },
        render (h) {
            return h('div', [
              h('div', this.count),
              h('button', {
                on: {
                  click: this.increment
                }
              }, 'increase'),

              h('button', {
                on: {
                  click: this.decrement
                }
              }, 'decrease')
            ])
        }
      }).$mount('#vue1')
    </script>

    <section class="slide">
        <h2>
            Код счетчика
        </h2>

        <pre>
            <code>&lt;div id="counter">{{count}}&lt;/div></code>
            <code> </code>
            <code>new Vue({</code>
            <code>  data: { count: 0 },</code>
            <code>};</code>
        </pre>
    </section>

    <section class="slide">
        <h2>
            Код счетчика
        </h2>

        <pre>
            <code>new Vue({</code>
            <code>  data: { count: 0 },</code>
            <code>  methods: {</code>
            <code>    increment () { this.count +=1 };</code>
            <code>    decrement () { this.count -= 1 };</code>
            <code>  }</code>
            <code>};</code>
        </pre>
    </section>

    <section class="slide">
        <h2>
            Мотивация автора
        </h2>
        ~~~ Спрайт шит таблицы
    </section>

    <section class="slide">
        <h2>
            Мотивация автора
        </h2>
        <pre>
            <code>let a = 1;</code>
            <code>let b = a * 10;</code>
            <code>console.log(b);<span class="comment">// b === 10</span></code>
            <code> </code>
            <code>a = 2;<span class="comment">// a === 2</span></code>
            <code>console.log(b);<span class="comment">// b === 10</span></code>
        </pre>
    </section>

    <section class="slide">
        <h2>
            Мотивация автора
        </h2>
        <pre>
            <code>let a = 1;</code>
            <code>let b = a * 10;</code>
            <code> </code>
            <code>onAChange(() => {</code>
            <code>  b = a * 10;</code>
            <code>});</code>
        </pre>
    </section>

    <section class="slide">
        <h2>
            Мотивация автора
        </h2>
        <pre>
            <code>let a = 1;</code>
            <code>let b = a * 10;</code>
            <code> </code>
            <code>onAChange(<mark>() => {</mark></code>
            <code><mark>  b = a * 10;</mark></code>
            <code><mark>}</mark>);</code>
        </pre>
    </section>

    <section class="slide">
        <h2>
            Мотивация автора
        </h2>
        <pre>
            <code>let a = 1;</code>
            <code>let b = a * 10;</code>
            <code> </code>
            <code>onAChange(() => {</code>
            <code>  b = a * 10;</code>
            <code>  <mark>console.log(b);</mark></code>
            <code>});</code>
        </pre>
    </section>

    <section class="slide">
        <pre>
            <code>&lt;div class="cell b1">&lt;/div></code>
            <code> </code>
            <code>render = (a) => {</code>
            <code>  document.querySelector('cell b1').innerText = a;</code>
            <code>}</code>
            <code> </code>
            <code>let a = 1;</code>
            <code>render(a);<span class="comment">// &lt;div class="cell b1">1&lt;/div></span></code>
        </pre>
    </section>

    <section class="slide">
        <pre>
            <code class="none"></code>
            <code class="none"></code>
            <code class="none"></code>
            <code class="none"></code>
            <code class="none"></code>
            <code class="none"></code>
            <code>let a = 1;</code>
            <code>render(a);<span class="comment">// &lt;div class="cell b1">1&lt;/div></span></code>
            <code> </code>
            <code>a++</code>
            <code> </code>
            <code>onStateChange(() => render(a));</code>
            <code><span class="comment">// &lt;div class="cell b1"&gt;2&lt;/div></span></code>
        </pre>
    </section>

    <section class="slide">
        <pre>
            <code>let update</code>
            <code>const onStateChange((_update) => {</code>
            <code>  update = _update;</code>
            <code>})</code>
            <code>const setState = (newState) => {</code>
            <code>  state = newState;</code>
            <code>  update();</code>
            <code>};</code>
        </pre>
    </section>

    <section class="slide">
        <pre>
            <code>let state = { count: 0 };</code>
            <code>let b;</code>
            <code>onStateChange(() => { <span class="comment">// render === () => { b = state; }</span></code>
            <code>  b = state.count;</code>
            <code>  console.log(`log: variable b changed to ${b}`);</code>
            <code>});</code>
            <code>setState({ count: 1 });<span class="comment"> // log: variable b changed to 1 </span></code>
            <code><span class="comment">// update() => onStateChange() => console.log()</span></code>
            <code> </code>
        </pre>
    </section>

    <section class="slide">
        <pre>
            <code>let state = { count: 0 };</code>
            <code>let b;</code>
            <code>onStateChange(() => { <span class="comment">// render === () => { b = state; }</span></code>
            <code>  b = state.count;</code>
            <code>  console.log(`log: variable b changed to ${b}`);</code>
            <code>});</code>
            <code class="crossout">setState({ count: 1 });</code>
            <code>state.count = 1;<span class="comment"> // log: variable b changed to 1 </span></code>
            <code><span class="comment">// update() => onStateChange() => console.log()</span></code>
        </pre>
    </section>

    <section class="slide">
        <h2 class="shout">
            Реализация
        </h2>
    </section>

    <section class="slide">
        <img class="cover" src="https://ru.vuejs.org/images/data.png" alt="reactivity">
    </section>

    <section class="slide">
        <h2>
            Архитектура работы с состоянием
        </h2>
        <ul>
            <li>Наблюдатель (observer) <code class="comment">// object -> get/set</code></li>
            <li>
                Мониторинг зависимостей (dependencies tracking)
                <br>
                <code class="comment">// stateChange -> notify</code>
            </li>
            <li>Функция отрисовки (render)<code class="comment">// render()</code></li>
        </ul>
    </section>

    <section class="slide">
        <h2>
            Как работает Vue (абстрактно)
        </h2>

        <pre>
            <code>state = { a: 5 }</code>
            <code>observe(state)</code>
            <code><span class="comment">// a -> a: { get () {}, set () => {} }</span></code>
            <code>render(state) <span class="comment">// depend (state.a) </span></code>
            <code>state.a = 10 </code>
            <code><span class="comment">// notify () => depends.forEach(dep => dep()) )</span> </code>
            <code><span class="comment">// => render()</span></code>
        </pre>

    </section>

    <section class="slide">
        <h2>
            Задачи:
        </h2>
        <pre>
            <code>function observe(stateObject);</code>
            <code> </code>
            <code>class Dep {</code>
            <code>  depend(),</code>
            <code>  notify()</code>
            <code>};</code>
            <code> </code>
            <code>function install(() => render(stateObject));</code>
        </pre>
    </section>

    <section class="slide">
        <h2>
            Observe
        </h2>

        <pre>
            <code>function observe (object) {</code>
            <code>  Object.keys(obj).map((key) => {</code>
            <code>    let value = obj[key];</code>
            <code>    Object.defineProperty(obj, key, {</code>
            <code>      get () { return value },</code>
            <code>      set (newValue) { value = newValue },</code>
            <code>    });</code>
            <code>  };</code>
            <code>};</code>
        </pre>
    </section>

    <section class="slide">
        <h2>
            Dep
        </h2>

        <pre>
            <code>class Dep {</code>
            <code>  constructor () {</code>
            <code>    this.dependencies = new Set()</code>
            <code>  },</code>
            <code>  depend () {  this.dependencies.add(update) },</code>
            <code>  notify () {  this.dependencies.forEach(dep => dep()) }</code>
            <code>}</code>
            <code> <span class="comment">// update === () => { render() }</span></code>
        </pre>

    </section>

    <section class="slide">
        <h2>
            Задачи:
        </h2>
        <ol>
            <li>Конвертировать поля объекта в гетеры и сетеры </li>
            <li>Реализовать функции отслеживания изменений (depend и notify)</li>
            <li>Механизм вызова функции отрисовки при изменении данных</li>
            <li>Функция отрисовки (render)</li>
        </ol>
    </section>

    <section class="slide">
        <h2 class="shout">
            Live coding!
        </h2>
    </section>

    <section class="slide">
        <h2>
            Сравнение
        </h2>

        <div>
            Счетчик на Vue:
            <div id="vue2"></div>
        </div>

        <div>
            Счетчик на js:
            <div id="testId"></div>
            <button onClick="addClick()">Increment</button>
            <button onClick="removeClick()">Decrement</button>
        </div>
    </section>

    <script>
      new Vue({
        data: {
          count: 1
        },
        methods: {
          increment () {
            this.count += 1
          },
          decrement () {
            this.count -= 1
          }
        },
        render (h) {
          return h('div', [
            h('div', this.count),
            h('button', {
              on: {
                click: this.increment
              }
            }, 'increase'),

            h('button', {
              on: {
                click: this.decrement
              }
            }, 'decrease')
          ])
        }
      }).$mount('#vue2')

    </script>

    <section class="slide">
        <h2 class="shout">
            Заключение
        </h2>
    </section>

    <section class="slide">
        <h2>
            О чем не рассказал
        </h2>
        <ul>
            <li>Дериктива v-model (v-bind + v-on)</li>
            <li>Составные свойства (computed property)</li>
            <li>Функция watch</li>
        </ul>
    </section>

    <section class="slide">
        <h2>
            Полезные материалы
        </h2>
        <ul>
            <li><a href="">Материал ; </a></li>
            <li><a href="">Материал ; </a></li>
            <li><a href="">Материал ; </a></li>
            <li><a href="">Материал ; </a></li>
        </ul>
    </section>

    <section class="slide">
        <h2 class="shout">
            Спасибо за внимание!
        </h2>

        <br>
        <br>
    </section>
    <section class="slide">
        <h2 class="shout">
            Вопросы?
        </h2>
    </section>

    <div class="progress"></div>

    <script src="node_modules/shower-core/shower.min.js"></script>
    <script src="reactivity.js"></script>
    <!-- Copyright © 2019 Yours Truly, Famous Inc. -->

</body>
</html>
